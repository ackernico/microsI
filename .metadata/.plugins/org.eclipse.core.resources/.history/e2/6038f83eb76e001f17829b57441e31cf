/*
 * Exercício 5 :
  Acione os leds em sequência, começando de uma ponta da linha e
  percorrendo até a outra ponta, acionando somente um led. O led aceso deve
  “percorrer” a extensão da linha, indo de uma extremidade a outra e
  retornando. Seguir com este movimento indefinidamente.

  Exercício 6 :
  Acione os leds em sequência, começando de uma ponta da linha e
  percorrendo até a outra ponta, acionando o proximo led, mantendo o anterior
  acionado. Ao preencher a linha, retornar apagando os leds.

  Exercício 7 :
  Crie (invente, inove, seja criativo) um efeito visual na linha de leds, a exemplo
  dos exercícios anteriores.

  Exercício 8 :
  Utilizando duas chaves conectadas ao kit, junte os codigos 5 a 7,
  selecionando o efeito através das chaves.
 */

#include "stm32f4xx.h"

void ajuda(int x, int var[8], char *op){
	if(op == 'd'){
		GPIOC->ODR &= ~var[x-1];
		GPIOC->ODR |= var[x];
	}
	else if(op == 'c'){
		GPIOC->ODR |= var[8-x];
		GPIOC->ODR &= ~var[8-x+1];
	}
}

int main(void)
{
  RCC->AHB1ENR = 0x87;
  RCC->APB2ENR = 1 << 17;

  GPIOA->MODER |= 0x28000400;
  GPIOC->MODER |= 0b0101010101010101;
  TIM10->CR1 = 0b1;
  TIM10->PSC = 7999;
  TIM10->ARR = 999;

  int led[] = {  0b00000001, //Led1
  	  	  	  	 0b00000010, //Led2
  	  	  	  	 0b00000100, //Led3
  	  	  	  	 0b00001000, //Led4
  	  	  	  	 0b00010000, //Led5
  	  	  	  	 0b00100000, //Led6
  	  	  	  	 0b01000000, //Led7
  	  	  	  	 0b10000000};//Led8
  int cont=0;

	while (1)
  {
	if(TIM10->SR & 0x1){
		cont++;

		switch(cont){
		case 1:
			GPIOC->ODR |= led[0];
			break;
		case 2:
			ajuda(1, led, "d");
			break;
		case 3:
			ajuda(2, led, "d");
			break;
		case 4:
			ajuda(3, led, "d");
			break;
		case 5:
			ajuda(4, led, "d");
			break;
		case 6:
			ajuda(5, led, "d");
			break;
		case 7:
			ajuda(6, led, "d");
			break;
		case 8:
			ajuda(7, led, "d");
			break;
		case 9:
			ajuda(8, led, "c");
			break;
		case 10:
			ajuda(7, led, "c");
			break;
		case 11:
			ajuda(6, led, "c");
			break;
	    default:
			GPIOC->ODR ^= led[7];
			break;
		}

		TIM10->SR &= 0b0;
	}
  }
}
